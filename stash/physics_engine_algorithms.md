
# Алгоритмы для создания физического движка

Создание физического движка включает в себя реализацию большого количества алгоритмов из разных областей. Ниже приведён полный список компонентов, необходимых для реализации, включая формулы и описание алгоритмов.

---

## 1. Динамика тел (Rigid Body Dynamics)

### 1.1 Интеграторы движения

#### Euler Integration (Простой, неустойчивый)
```
x += v * dt
v += a * dt
```
#### Semi-implicit Euler
```
v += a * dt
x += v * dt
```
#### Verlet Integration
```
x_new = 2 * x - x_prev + a * dt^2
```
#### Runge-Kutta 4 (RK4)
Используется система промежуточных вычислений k1-k4 для получения следующего значения.

#### Symplectic Integrator
Более устойчивый для сохранения энергии в долгосрочной симуляции.

### 1.2 Обработка сил
- Гравитация: `F = m * g`
- Сопротивление: `F_drag = -k * v`
- Пружины: `F_spring = -k * (x - x_rest)`
- Внешние силы: задаются напрямую через API

---

## 2. Коллизии (Collisions)

### 2.1 Обнаружение столкновений

#### Broad Phase (грубая фильтрация)
- AABB (Axis-Aligned Bounding Box)
- Bounding Volume Hierarchies (BVH)
- Sweep and Prune
- Spatial Hashing

#### Narrow Phase (точная проверка)
- GJK (Gilbert–Johnson–Keerthi)
- EPA (Expanding Polytope Algorithm)
- SAT (Separating Axis Theorem)

### 2.2 Контактные точки (Contact Manifold Generation)
- Clipping-based contact generation
- GJK + EPA manifold construction
- Feature-based generation (vertex-face, edge-edge и т.п.)

Используются для расчета силы реакции, особенно при множественных касаниях.

---

## 3. Разрешение столкновений (Collision Resolution)

### Impulse-based метод (основной)
Импульс на контактной точке:
```
j = -(1 + e) * (v_rel · n) / (1/m1 + 1/m2)
```
где:
- `e` — коэффициент упругости
- `v_rel` — относительная скорость
- `n` — нормаль контакта

### Penalty-based метод
Используются силы отталкивания пропорционально глубине проникновения.

### Constraint-based метод
Система ограничений решается с помощью Lagrange Multipliers или Sequential Impulse.

---

## 4. Система ограничений (Constraints)
- Шарниры, пружины, соединения
- Решение через систему уравнений
- Часто используется метод Якоби или Гаусса-Зейделя

---

## 5. Обработка твёрдых тел (Rigid Body Motion)

### Параметры:
- Масса: `m`
- Инерция: `I` (тензор инерции)
- Скорости: линейная `v`, угловая `ω`
- Момент силы: `τ = r × F`
- Кватернионы для вращения

### Формулы:
```
F = m * a
τ = I * α
dq/dt = 0.5 * ω * q
```
где `q` — кватернион, `ω` — угловая скорость (в кватернион-форме)

---

## 6. Обработка мягких тел (Soft Body Dynamics)

- Mass-Spring Systems
- Finite Element Method (FEM)
- Position-Based Dynamics (PBD)

---

## 7. Система частиц (Particle Systems)

- Без инерции, только сила и позиция
- Простая интеграция: Euler, Verlet
- Используется в эффектах: дым, искры и т.д.

---

## 8. Численные методы и оптимизация

- Решение линейных систем: Jacobi, Gauss-Seidel, Conjugate Gradient
- Сортировка для Broad Phase (например, Axis Sort)
- SIMD-оптимизация
- Параллельная обработка (многопоточность, job-система)

---

## 9. Многопоточность и параллелизм

- Разделение на задачи (Job System)
- Thread-safe очереди
- Асинхронная обработка коллизий и интеграции

---

## 10. Структура мира (World/Scene Management)

- Пространственные структуры (BVH, Octree, Grid)
- Хранение тел, параметров (трение, упругость)
- Поддержка слоёв столкновений и масок фильтрации

---

## Глоссарий

- `x` — позиция
- `v` — скорость
- `a` — ускорение
- `F` — сила
- `m` — масса
- `ω` — угловая скорость
- `q` — кватернион вращения
- `τ` — момент силы
- `I` — инерционный тензор

